<script>
  import { TableSort } from 'svelte-tablesort';
  import { moves } from '@/stores.js';
  import eff from '@d/eff.js';
  import { copy } from '@/u.js';
  import Details from '@c/Details.html';
  import TypeFilter from '@c/TypeFilter.html';
  import TypeIcon from '@c/TypeIcon.html';
  import Ruby from '@c/Ruby.html';

  let _moves;
  let type = location.hash ? location.hash.replace('#', '') : '';

  $: {
    if (type && !eff.some(_eff => _eff.type === type)) {
      type = null;
    }
    _moves = moveHandle($moves, type);
  };

  function clicktype(e) {
    let _type = e.detail.type;
    type = _type === type ? null : _type;
  }

  function moveHandle(moves) {
    if (type) {
      moves = moves.filter(m => m.type === type);
    }
    return moves
      .reduce((all, m) => {
        all[m.isFast ? 'fast' : 'charge'].push(m);
        return all;
      }, {
        fast: [],
        charge: [],
      });
  }
</script>




<!--  -->


<svelte:head>
  <title>Move</title>
</svelte:head>

<section>

  <TypeFilter type={type} on:clicktype={clicktype} />

  <Details type="fastmove" class="card">
    <summary><h3>Fast</h3></summary>


    <TableSort
      items={_moves.fast}
      class="sticky-thead ml-a mr-a"
    >
      <tr slot="thead">
        <th data-sort="type" data-sort-initial>@</th>
        <th data-sort="name">Name</th>
        <th data-sort="power" title="Damage">D</th>
        <th data-sort="energyGain" title="Energy">E</th>
        <th data-sort="turn" title="Turn">T</th>
        <th data-sort="dpt">DPT</th>
        <th data-sort="ept">EPT</th>
        <th data-sort="eptxdpt" title="EPT x DPT">Î </th>
      </tr>
      <tr slot="tbody" let:item={item}>
        <td>
          <TypeIcon type={item.type} />
        </td>
        <td>
          <a href="./move/{item.moveId}">
            <Ruby class="x">
              <div slot="rb">{item.name}</div>
              <div slot="rt">{item.moveId}</div>
            </Ruby>
          </a>
        </td>
        <td>{item.power}</td>
        <td>{item.energyGain}</td>
        <td>{item.turn}</td>
        <td>{item.dpt}</td>
        <td>{item.ept}</td>
        <td>{item.eptxdpt}</td>
      </tr>
    </TableSort>
  </Details>

  <Details type="chargemove" class="card">
    <summary><h3>Charge</h3></summary>

    <TableSort
      items={_moves.charge}
      class="sticky-thead ml-a mr-a"
    >
      <tr slot="thead">
        <th data-sort="type" data-sort-initial>@</th>
        <th data-sort="name">Name</th>
        <th data-sort="power" title="Damage">D</th>
        <th data-sort="energy" title="Energy">E</th>
        <th data-sort="dpe">DPE</th>
        <th data-sort="effect">Effect</th>
      </tr>
      <tr slot="tbody" let:item={item}>
        <td class="p-0 text-center">
          <TypeIcon type={item.type} class="d-ib" />
        </td>
        <td>
          <a href="./move/{item.moveId}">
            <Ruby class="x">
              <div slot="rb">{item.name}</div>
              <div slot="rt">{item.moveId}</div>
            </Ruby>
          </a>
        </td>
        <td>{item.power}</td>
        <td>{item.energy}</td>
        <td>{item.dpe}</td>
        <td class="fz-s">{item.effect || ''}</td>
      </tr>
    </TableSort>
  </Details>

</section>



<!--  -->


<style></style>
