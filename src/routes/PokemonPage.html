<script>
export let params = {};
import { pokemons } from '@/stores.js';
import Details from '@c/Details.html';
import CP from '@c/CP.html';
import Moveset from '@c/Moveset.html';
import TypeFactor from '@c/TypeFactor.html';
import Ruby from '@c/Ruby.html';
import TypeIcon from '@c/TypeIcon.html';
import FloatLink from '@c/FloatLink.html';
import QueryPM from '@c/QueryPM.html';

let pm;
let ads;
let nextPm;
let prevPm;

$: {
  if ($pokemons.length) {
    let idx = $pokemons.findIndex(pm => pm.uid === params.uid);
    if (idx === -1) {
      idx = 0;
    }
    pm = $pokemons[idx];

    ads = {
      atk: pm._atk,
      def: pm._def,
      sta: pm._sta,
    };

    if (idx > 1) {
      prevPm = $pokemons[idx - 1];
    }
    if (idx < $pokemons.length - 2) {
      nextPm = $pokemons[idx + 1];
    }
  }
}

</script>


<svelte:head>
  <title>{pm && `#${pm.dex} ${pm.name}` || ''}</title>
</svelte:head>

{#if pm}
  <section class="pos-r df fd-c">

    <QueryPM uid={pm.uid} />

    <FloatLink pm1={prevPm} pm2={nextPm} />

    <Details type="pm_meta" class="card">
      <summary class="pos-r">
        <h2 class="d-if fxw-w" style="width: calc(100% - 1rem - 2vw)">
          <div class="df fxw-w">
            <Ruby>
              <div slot="rb">
                {pm.name}
              </div>
              <div slot="rt" class="fw-n text-uppercase">{pm.id}</div>
            </Ruby>

            <sup class="fw-n ml-1 mr-1">#{pm.dex}</sup>
            <span class="d-if">
              {#each pm.types as type}
                <TypeIcon type={type} class="mr-1" />
              {/each}
            </span>
          </div>

          <div class="ads fw-n ml-a">
            Atk: {pm._atk}<br>
            Def: {pm._def}<br>
            Sta: {pm._sta}<br>
          </div>
        </h2>
      </summary>
      <hr>
    </Details>

    <CP ads={ads} />

    <TypeFactor types={pm.types} />

    <Moveset pm={pm} />

    <details>
      <summary>raw data</summary>
      <pre>
        {JSON.stringify(pm, null, 2)}
      </pre>
    </details>
  </section>
{/if}



<style>
  .ads {
    font-size: initial;
  }
</style>
