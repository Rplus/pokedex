<script>
  import { pokemons, moves } from '@/stores.js';

  let q = new URLSearchParams(location.search).get('q') || 'shadow';
  let result = [[], []];

  $: {
    if ($pokemons.length) {
      q = q.toLowerCase();
      result = q ?[queryPm(q), queryMove(q)] : [[], []];
    }
  }

  $: {
    window.history.replaceState(null, '', `?q=${q}`);
  }

  function queryPm(kwd) {
    return $pokemons.filter(pm => {
      return (
        pm.uid.indexOf(kwd) !== -1 ||
        pm.name.indexOf(kwd) !== -1 ||
        pm.id.indexOf(kwd) !== -1 ||
        pm.types.indexOf(kwd) !== -1
      );
    });
  }

  function queryMove(kwd) {
    return $moves.filter(move => {
      return (
        move.name.indexOf(kwd) !== -1 ||
        move.moveId.toLowerCase().indexOf(kwd) !== -1 ||
        move.type.indexOf(kwd) !== -1
      );
    });
  }

</script>


<div class="card">
  <div class="pt-4">
    Q <input type="search" bind:value={q} autofocus>
  </div>

  <details open class="mb-6">
    <summary>PM</summary>
    <ul>
      {#each result[0] as item}
        <li class="mb-1">
          <a class="result-link" href="/pokemon/{item.uid}">
            #{item.dex} {item.name} {item.id}
          </a>
        </li>
        <!-- <pre>{JSON.stringify(item, 0, 2)}</pre> -->
      {/each}
    </ul>
  </details>

  <details open>
    <summary>MOVE</summary>
    <ul>
      {#each result[1] as item}
        <li class="mb-1">
          <a class="result-link" href="/move/{item.moveId}">
            {item.name} {item.moveId}
          </a>
        </li>
        <!-- <pre>{JSON.stringify(item, 0, 2)}</pre> -->
      {/each}
    </ul>
  </details>
</div>



<style>
  .result-link {
    color: inherit;
    text-decoration: none;
  }
  .result-link:hover {
    text-decoration: underline;
    text-decoration-style: dotted;
  }
</style>
