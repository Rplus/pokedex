<script>
  import { pokemons, moves } from '@/stores.js';

  let q = new URLSearchParams(location.search).get('q') || '';
  let result = [[], []];

  $: {
    if ($pokemons.length) {
      result = q ?[queryPm(q), queryMove(q)] : [[], []];
    }
  }

  $: {
    window.history.replaceState(null, '', q ? `?q=${q}` : '');
  }

  function queryPm(kwd) {
    return $pokemons.filter(pm => {
      let r = new RegExp(kwd, 'i');
      return (
        r.test(pm.uid) ||
        r.test(pm.name) ||
        r.test(pm.id) ||
        r.test(pm.types)
      );
    });
  }

  function queryMove(kwd) {
    return $moves.filter(move => {
      let r = new RegExp(kwd, 'i');
      return (
        r.test(move.name) ||
        r.test(move.moveId) ||
        r.test(move.type)
      );
    });
  }

</script>


<div class="card">
  <div class="pt-4">
    Q <input type="search" bind:value={q}>
  </div>

  <details open class="mb-6">
    <summary>PM</summary>
    <ul>
      {#each result[0] as item}
        <li class="mb-1">
          <a class="result-link" href="/pokemon/{item.uid}">
            #{item.dex} {item.name} {item.id}
          </a>
        </li>
        <!-- <pre>{JSON.stringify(item, 0, 2)}</pre> -->
      {/each}
    </ul>
  </details>

  <details open>
    <summary>MOVE</summary>
    <ul>
      {#each result[1] as item}
        <li class="mb-1">
          <a class="result-link" href="/move/{item.moveId}">
            {item.name} {item.moveId}
          </a>
        </li>
        <!-- <pre>{JSON.stringify(item, 0, 2)}</pre> -->
      {/each}
    </ul>
  </details>
</div>



<style>
  .result-link {
    color: inherit;
    text-decoration: none;
  }
  .result-link:hover {
    text-decoration: underline;
    text-decoration-style: dotted;
  }
</style>
